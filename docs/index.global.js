"use strict";(()=>{var Jt=Object.create;var ye=Object.defineProperty,Qt=Object.defineProperties,jt=Object.getOwnPropertyDescriptor,eo=Object.getOwnPropertyDescriptors,to=Object.getOwnPropertyNames,se=Object.getOwnPropertySymbols,oo=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var Xe=(e,o,t)=>o in e?ye(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,Ge=(e,o)=>{for(var t in o||={})ge.call(o,t)&&Xe(e,t,o[t]);if(se)for(var t of se(o))Ze.call(o,t)&&Xe(e,t,o[t]);return e},qe=(e,o)=>Qt(e,eo(o));var Ke=(e,o)=>{var t={};for(var r in e)ge.call(e,r)&&o.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&se)for(var r of se(e))o.indexOf(r)<0&&Ze.call(e,r)&&(t[r]=e[r]);return t};var z=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);var ro=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of to(o))!ge.call(e,a)&&a!==t&&ye(e,a,{get:()=>o[a],enumerable:!(r=jt(o,a))||r.enumerable});return e};var s=(e,o,t)=>(t=e!=null?Jt(oo(e)):{},ro(o||!e||!e.__esModule?ye(t,"default",{value:e,enumerable:!0}):t,e));var m=z((Ho,$e)=>{$e.exports=globalThis.React});var N=z((Lo,Je)=>{Je.exports=globalThis.RTK});var he=z((qo,mt)=>{mt.exports=globalThis.ReactRedux});var yt=z(fe=>{"use strict";var ao=m(),so=Symbol.for("react.element"),io=Symbol.for("react.fragment"),uo=Object.prototype.hasOwnProperty,lo=ao.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,po={key:!0,ref:!0,__self:!0,__source:!0};function xt(e,o,t){var r,a={},n=null,i=null;t!==void 0&&(n=""+t),o.key!==void 0&&(n=""+o.key),o.ref!==void 0&&(i=o.ref);for(r in o)uo.call(o,r)&&!po.hasOwnProperty(r)&&(a[r]=o[r]);if(e&&e.defaultProps)for(r in o=e.defaultProps,o)a[r]===void 0&&(a[r]=o[r]);return{$$typeof:so,type:e,key:n,ref:i,props:a,_owner:lo.current}}fe.Fragment=io;fe.jsx=xt;fe.jsxs=xt});var l=z((jo,gt)=>{"use strict";gt.exports=yt()});var Oe=z((ln,Ot)=>{Ot.exports={v4:globalThis.uuidv4}});var Yt=z((ha,Vt)=>{Vt.exports=globalThis.ReactDOM});var Xt=z(Ye=>{"use strict";var Wt=Yt();Ye.createRoot=Wt.createRoot,Ye.hydrateRoot=Wt.hydrateRoot;var ba});var Ht=s(m());var be=s(m());var Qe=s(N()),no={position:{x:0,y:0,z:1}},je=(0,Qe.createSlice)({name:"app",initialState:no,reducers:{openContextMenu(e,{payload:o}){e.contextMenu=o},closeContextMenu(e){e.contextMenu=void 0},openDialog(e,{payload:o}){e.dialog=o},closeDialog(e){e.dialog=void 0},setDragging(e,{payload:o}){e.dragging=o},setPosition(e,{payload:o}){e.position.x=o.x,e.position.y=o.y,e.position.z=o.z}}}),{closeContextMenu:$,closeDialog:F,openContextMenu:et,openDialog:Se,setDragging:ve,setPosition:tt}=je.actions,ot=je.reducer;var ie=s(N()),_=(0,ie.createEntityAdapter)(),rt=(0,ie.createSlice)({name:"backdrops",initialState:_.getInitialState(),reducers:{addBackdrop:_.upsertOne,addBackdrops:_.upsertMany,updateBackdrop:_.updateOne}}),{addBackdrop:nt,addBackdrops:_o,updateBackdrop:Uo}=rt.actions,at=rt.reducer;var ue=s(N()),U=(0,ue.createEntityAdapter)(),st=(0,ue.createSlice)({name:"tokens",initialState:U.getInitialState(),reducers:{addToken:U.upsertOne,addTokens:U.upsertMany,updateToken:U.updateOne}}),{addToken:it,addTokens:ut,updateToken:lt}=st.actions,pt=st.reducer;var le=e=>e.app.contextMenu,V=e=>e.app.dialog,ft=e=>e.app.dragging,Y=e=>e.app.position,{selectAll:ct,selectEntities:Zo}=U.getSelectors(e=>e.tokens),{selectAll:dt}=_.getSelectors(e=>e.backdrops);var pe=s(he()),S=pe.useDispatch,x=pe.useSelector;var ce=s(l()),co={position:"absolute",left:0,top:0,bottom:0,right:0,zIndex:99,background:"black",opacity:.1};function St({isShown:e,onClick:o}){return e?(0,ce.jsx)("div",{style:co,onClick:o}):null}function vt(){let e=S(),o=x(le),t=(0,be.useCallback)(()=>{e($())},[e]);return(0,ce.jsx)(St,{isShown:!!o,onClick:t})}function ht(){let e=S(),o=x(V),t=(0,be.useCallback)(()=>{e(F())},[e]);return(0,ce.jsx)(St,{isShown:!!o,onClick:t})}var b=s(m());var R=s(m());var J=s(m());function De(e=!1){let[o,t]=(0,J.useState)(e),r=(0,J.useCallback)(()=>t(!1),[]),a=(0,J.useCallback)(()=>t(!0),[]);return[o,{clear:r,set:a}]}function ke(e,o=0){let[t,{clear:r,set:a}]=De(!1),[n,i]=(0,R.useState)(NaN),[u,y]=(0,R.useState)(NaN),d=(0,R.useMemo)(()=>t?"grabbing":"grab",[t]),g=(0,R.useCallback)(c=>{c.button===o&&(a(),i(c.clientX),y(c.clientY))},[o,a]),f=(0,R.useCallback)(c=>{if(t){let P=c.clientX-n,A=c.clientY-u;e(P,A),i(c.clientX),y(c.clientY)}},[t,e,n,u]),p=(0,R.useCallback)(c=>{t&&(f(c),r())},[t,r,f]);return{cursor:d,onPointerDown:g,onPointerUp:p,onPointerMove:f}}function bt(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];e&&e.addEventListener&&e.addEventListener.apply(e,o)}function Dt(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];e&&e.removeEventListener&&e.removeEventListener.apply(e,o)}var de=typeof window<"u";var kt=s(m()),mo=function(e){(0,kt.useEffect)(e,[])},Q=mo;var W=s(m());var Ct=s(m());var xo=function(e){var o=(0,Ct.useRef)(e);o.current=e,Q(function(){return function(){return o.current()}})},Pt=xo;var yo=function(e){var o=(0,W.useRef)(0),t=(0,W.useState)(e),r=t[0],a=t[1],n=(0,W.useCallback)(function(i){cancelAnimationFrame(o.current),o.current=requestAnimationFrame(function(){a(i)})},[]);return Pt(function(){cancelAnimationFrame(o.current)}),[r,n]},Tt=yo;var E=s(m());function me(e,o){o===void 0&&(o=!0);var t=(0,E.useRef)(null),r=(0,E.useRef)(!1),a=(0,E.useRef)(e);a.current=e;var n=(0,E.useCallback)(function(u){r.current&&(a.current(u),t.current=requestAnimationFrame(n))},[]),i=(0,E.useMemo)(function(){return[function(){r.current&&(r.current=!1,t.current&&cancelAnimationFrame(t.current))},function(){r.current||(r.current=!0,t.current=requestAnimationFrame(n))},function(){return r.current}]},[]);return(0,E.useEffect)(function(){return o&&i[1](),i[0]},[]),i}var wt=s(m());var go=function(e,o){e===void 0&&(e=1/0),o===void 0&&(o=1/0);var t=Tt({width:de?window.innerWidth:e,height:de?window.innerHeight:o}),r=t[0],a=t[1];return(0,wt.useEffect)(function(){if(de){var n=function(){a({width:window.innerWidth,height:window.innerHeight})};return bt(window,"resize",n),function(){Dt(window,"resize",n)}}},[]),r},Ce=go;function Pe(e,o,t){return e>t?t:e<o?o:e}var we=s(m());var xe="app/drag";function M(e){return 100*e}function X(e,o,t,r,a){let n=M(t),i=Math.round((r-e)/n),u=Math.round((a-o)/n);return[i,u]}function Te(e){return JSON.parse(e)}function j(e,o,t){let r=S(),a=(0,we.useCallback)(i=>{i.preventDefault(),i.dataTransfer.dropEffect="move"},[]),n=(0,we.useCallback)(i=>{i.preventDefault();let{id:u,ox:y,oy:d}=Te(i.dataTransfer.getData(xe)),[g,f]=X(e+y,o+d,t,i.clientX,i.clientY);r(lt({id:u,changes:{x:g,y:f}}))},[r,e,o,t]);return{onDragOver:a,onDrop:n}}var Et=s(l()),So=500,vo=.2,ho=3;function Ee({onPaint:e}){let o=S(),[t,r]=(0,b.useState)(0),[a,n]=(0,b.useState)(0),[i,u]=(0,b.useState)(1),[y,d]=me(()=>{var L;let T=(L=g.current)==null?void 0:L.getContext("2d");T&&g.current&&(e(T,g.current,t,a,i),y())},!0),g=(0,b.useRef)(null),{width:f,height:p}=Ce();(0,b.useEffect)(()=>d(),[f,p,t,a,i,d]);let c=(0,b.useCallback)((T,L)=>{r(K=>K+T),n(K=>K+L)},[]),P=(0,b.useCallback)(T=>{if(T.deltaMode===WheelEvent.DOM_DELTA_PIXEL){let L=T.deltaY/-So;u(K=>Pe(K+L,vo,ho))}},[]),A=(0,b.useCallback)(T=>{o(et({type:"new",x:T.clientX,y:T.clientY})),T.preventDefault()},[o]),{onDragOver:I,onDrop:q}=j(t,a,i),We=ke(c),{cursor:ae}=We,Kt=Ke(We,["cursor"]),$t=(0,b.useMemo)(()=>({cursor:ae,width:f,height:p}),[ae,p,f]);return(0,Et.jsx)("canvas",qe(Ge({},Kt),{"data-testid":"scrollable-canvas",ref:g,width:f,height:p,style:$t,onWheel:P,onDragOver:I,onDrop:q,onContextMenu:A}))}var H=s(m());var Ae=s(l());function Re({backdrop:e}){let o=x(Y),t=(0,H.useMemo)(()=>M(o.z),[o.z]),r=(0,H.useMemo)(()=>e.x*t+o.x,[t,o.x,e.x]),a=(0,H.useMemo)(()=>e.y*t+o.y,[t,o.y,e.y]),n=(0,H.useMemo)(()=>t*e.width,[t,e.width]),i=(0,H.useMemo)(()=>t*e.height,[t,e.height]),u=(0,H.useMemo)(()=>({position:"absolute",pointerEvents:"none",left:r,top:a,zIndex:10,width:n,height:i}),[i,r,a,n]);return(0,Ae.jsx)("div",{style:u,children:(0,Ae.jsx)("img",{src:e.url,alt:e.id,width:n,height:i})})}var ee=s(l());function Me(){let e=x(dt);return(0,ee.jsx)(ee.Fragment,{children:e.map(o=>(0,ee.jsx)(Re,{backdrop:o},o.id))})}var v=s(m());var Z=s(m()),B=s(l()),At={display:"flex",width:300,gap:4},Rt={fontWeight:"bold",width:40,textAlign:"right"},Mt={flexGrow:1};function G({label:e,value:o,setValue:t}){let r=(0,Z.useId)(),a=(0,Z.useCallback)(n=>t(n.currentTarget.value),[t]);return(0,B.jsxs)("div",{style:At,children:[(0,B.jsx)("label",{htmlFor:r,style:Rt,children:e}),(0,B.jsx)("input",{id:r,style:Mt,type:"string",value:o,onChange:a})]})}function O({label:e,value:o,setValue:t,min:r,max:a}){let n=(0,Z.useId)(),i=(0,Z.useCallback)(u=>t(u.currentTarget.valueAsNumber),[t]);return(0,B.jsxs)("div",{style:At,children:[(0,B.jsx)("label",{htmlFor:n,style:Rt,children:e}),(0,B.jsx)("input",{id:n,style:Mt,type:"number",value:o,onChange:i,min:r,max:a})]})}var It=s(Oe()),D=s(l()),Do={position:"fixed",zIndex:100,top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",background:"white",border:"1px solid black",padding:4,display:"flex",flexDirection:"column",overflow:"hidden"},ko={display:"flex"},Co={flexGrow:1};function Ie(){let e=(0,v.useId)(),o=S(),t=x(V),[r,a]=(0,v.useState)(""),[n,i]=(0,v.useState)(""),[u,y]=(0,v.useState)(0),[d,g]=(0,v.useState)(0),[f,p]=(0,v.useState)(1),[c,P]=(0,v.useState)(1);(0,v.useEffect)(()=>{(t==null?void 0:t.type)==="newBackdrop"&&(a((0,It.v4)()),i(""),y(t.x),g(t.y),p(1),P(1))},[t]);let A=(0,v.useCallback)(()=>{o(nt({id:r,url:n,x:u,y:d,width:f,height:c})),o(F())},[o,c,r,n,f,u,d]),I=(0,v.useMemo)(()=>{if(!r||!n)return!0},[r,n]),q=(0,v.useMemo)(()=>{if((t==null?void 0:t.type)==="newBackdrop"&&n)return(0,D.jsx)("img",{src:n,alt:r,width:64,height:64})},[t==null?void 0:t.type,r,n]);return(t==null?void 0:t.type)==="newBackdrop"?(0,D.jsxs)("div",{role:"dialog","aria-labelledby":e,style:Do,children:[(0,D.jsxs)("div",{style:ko,children:[(0,D.jsx)("h2",{id:e,style:Co,children:"New Backdrop..."}),q]}),(0,D.jsx)(G,{label:"ID",value:r,setValue:a}),(0,D.jsx)(G,{label:"URL",value:n,setValue:i}),(0,D.jsx)(O,{label:"X",value:u,setValue:y}),(0,D.jsx)(O,{label:"Y",value:d,setValue:g}),(0,D.jsx)(O,{label:"Width",value:f,setValue:p,min:1}),(0,D.jsx)(O,{label:"Height",value:c,setValue:P,min:1}),(0,D.jsx)("button",{disabled:I,onClick:A,children:"OK"})]}):null}var oe=s(m());var re=s(l());function ze(){let e=S(),o=x(le),t=x(Y),r=(0,oe.useCallback)(()=>{if(e($()),o){let[i,u]=X(t.x,t.y,t.z,o.x,o.y);e(Se({type:"newBackdrop",x:i,y:u}))}},[e,o,t]),a=(0,oe.useCallback)(()=>{if(e($()),o){let[i,u]=X(t.x,t.y,t.z,o.x,o.y);e(Se({type:"newToken",x:i,y:u}))}},[e,o,t]),n=(0,oe.useMemo)(()=>({position:"absolute",zIndex:100,left:o&&`${o.x}px`,top:o&&`${o.y}px`,background:"white",border:"1px solid black",padding:4,display:(o==null?void 0:o.type)==="new"?"flex":"none",flexDirection:"column"}),[o]);return(0,re.jsxs)("div",{style:n,children:[(0,re.jsx)("button",{onClick:r,children:"New Backdrop..."}),(0,re.jsx)("button",{onClick:a,children:"New Token..."})]})}var h=s(m());var zt=s(Oe()),C=s(l()),Po={position:"fixed",zIndex:100,top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",background:"white",border:"1px solid black",padding:4,display:"flex",flexDirection:"column",overflow:"hidden"},To={display:"flex"},wo={flexGrow:1};function Be(){let e=(0,h.useId)(),o=S(),t=x(V),[r,a]=(0,h.useState)(""),[n,i]=(0,h.useState)(""),[u,y]=(0,h.useState)(0),[d,g]=(0,h.useState)(0),[f,p]=(0,h.useState)(1);(0,h.useEffect)(()=>{(t==null?void 0:t.type)==="newToken"&&(a((0,zt.v4)()),i(""),y(t.x),g(t.y),p(1))},[t]);let c=(0,h.useCallback)(()=>{o(it({id:r,url:n,x:u,y:d,size:f})),o(F())},[o,r,f,n,u,d]),P=(0,h.useMemo)(()=>{if(!r||!n)return!0},[r,n]),A=(0,h.useMemo)(()=>{if((t==null?void 0:t.type)==="newToken"&&n)return(0,C.jsx)("img",{src:n,alt:r,width:64,height:64})},[t==null?void 0:t.type,r,n]);return(t==null?void 0:t.type)==="newToken"?(0,C.jsxs)("div",{role:"dialog","aria-labelledby":e,style:Po,children:[(0,C.jsxs)("div",{style:To,children:[(0,C.jsx)("h2",{id:e,style:wo,children:"New Token..."}),A]}),(0,C.jsx)(G,{label:"ID",value:r,setValue:a}),(0,C.jsx)(G,{label:"URL",value:n,setValue:i}),(0,C.jsx)(O,{label:"X",value:u,setValue:y}),(0,C.jsx)(O,{label:"Y",value:d,setValue:g}),(0,C.jsx)(O,{label:"Size",value:f,setValue:p,min:1,max:5}),(0,C.jsx)("button",{disabled:P,onClick:c,children:"OK"})]}):null}var k=s(m());function He(e){return JSON.stringify(e)}var Le=s(l());function Ne({token:e}){let o=(0,k.useRef)(null),t=S(),r=x(Y),a=(0,k.useMemo)(()=>M(r.z),[r.z]),n=(0,k.useMemo)(()=>e.x*a+r.x,[a,r.x,e.x]),i=(0,k.useMemo)(()=>e.y*a+r.y,[a,r.y,e.y]),u=(0,k.useMemo)(()=>a*e.size,[a,e.size]),y=(0,k.useCallback)(I=>{let q=I.clientX-n,ae=I.clientY-i;I.dataTransfer.setData(xe,He({id:e.id,ox:q,oy:ae})),I.dataTransfer.effectAllowed="move",t(ve(e.id))},[t,n,e.id,i]),d=(0,k.useCallback)(()=>{t(ve())},[t]),{onDragOver:g,onDrop:f}=j(r.x,r.y,r.z),p=(0,k.useCallback)(()=>{console.log("error",e.url)},[e.url]),c=x(ft),P=(0,k.useMemo)(()=>c?c===e.id?"all":"none":"all",[c,e.id]),A=(0,k.useMemo)(()=>({position:"absolute",cursor:"pointer",pointerEvents:P,left:n,top:i,zIndex:20-e.size,width:u,height:u}),[n,P,u,e.size,i]);return(0,Le.jsx)("div",{draggable:"true",style:A,onDragStart:y,onDragEnd:d,onDragOver:g,onDrop:f,children:(0,Le.jsx)("img",{ref:o,src:e.url,alt:e.id,width:u,height:u,onError:p})})}var ne=s(l());function Fe(){let e=x(ct);return(0,ne.jsx)(ne.Fragment,{children:e.map(o=>(0,ne.jsx)(Ne,{token:o},o.id))})}var w=s(l());function Bt(e,o){let t=e%o;return t<0?t+o:t}var Ao={overflow:"hidden",position:"relative"};function _e(){let e=S();Q(()=>{e(ut([{id:"Birnotec",url:"https://lagdotcom.github.io/dndavies-assets/tk/birnotec.png",x:2,y:3,size:1},{id:"Vassetri",url:"https://5e.tools/img/MM/Yuan-ti%20Abomination.png",x:4,y:4,size:2},{id:"Vassetri2",url:"https://5e.tools/img/MPMM/Yuan-ti%20Anathema.png",x:6,y:3,size:3}]))});let o=(0,Ht.useCallback)((t,r,a,n,i)=>{let{width:u,height:y}=r;t.clearRect(0,0,u,y);let d=M(i),g=Bt(a,d),f=Bt(n,d);t.lineWidth=1,t.strokeStyle="silver";for(let p=g;p<u;p+=d)t.beginPath(),t.moveTo(p,0),t.lineTo(p,y),t.stroke();for(let p=f;p<y;p+=d)t.beginPath(),t.moveTo(0,p),t.lineTo(u,p),t.stroke();e(tt({x:a,y:n,z:i}))},[e]);return(0,w.jsxs)("div",{style:Ao,children:[(0,w.jsx)(Ee,{onPaint:o}),(0,w.jsx)(Me,{}),(0,w.jsx)(Fe,{}),(0,w.jsx)(vt,{}),(0,w.jsx)(ht,{}),(0,w.jsx)(ze,{}),(0,w.jsx)(Ie,{}),(0,w.jsx)(Be,{})]})}var Ut=s(he());var Ft=s(N());var Lt=s(N());var Ro=(0,Lt.combineReducers)({app:ot,backdrops:at,tokens:pt}),Nt=Ro;function _t(e){return(0,Ft.configureStore)({reducer:Nt,preloadedState:e})}var Ue=s(l()),Mo=_t();function Ve(){return(0,Ue.jsx)(Ut.Provider,{store:Mo,children:(0,Ue.jsx)(_e,{})})}var Zt=s(Xt()),qt=s(l()),Gt=document.getElementById("app");if(!Gt)throw new Error("app container missing");var Oo=(0,Zt.createRoot)(Gt);Oo.render((0,qt.jsx)(Ve,{}));})();
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
