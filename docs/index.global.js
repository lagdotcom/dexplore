"use strict";(()=>{var Lo=Object.create;var _e=Object.defineProperty,Ho=Object.defineProperties,zo=Object.getOwnPropertyDescriptor,Fo=Object.getOwnPropertyDescriptors,No=Object.getOwnPropertyNames,Ee=Object.getOwnPropertySymbols,Uo=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable;var Dt=(e,t,o)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,re=(e,t)=>{for(var o in t||={})We.call(t,o)&&Dt(e,o,t[o]);if(Ee)for(var o of Ee(t))Tt.call(t,o)&&Dt(e,o,t[o]);return e},ne=(e,t)=>Ho(e,Fo(t));var Ae=(e,t)=>{var o={};for(var r in e)We.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&Ee)for(var r of Ee(e))t.indexOf(r)<0&&Tt.call(e,r)&&(o[r]=e[r]);return o};var G=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _o=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of No(t))!We.call(e,n)&&n!==o&&_e(e,n,{get:()=>t[n],enumerable:!(r=zo(t,n))||r.enumerable});return e};var s=(e,t,o)=>(o=e!=null?Lo(Uo(e)):{},_o(t||!e||!e.__esModule?_e(o,"default",{value:e,enumerable:!0}):o,e));var m=G((Pr,Pt)=>{Pt.exports=globalThis.React});var ae=G((Mr,Mt)=>{Mt.exports=globalThis.RTK});var Ge=G((Hr,Vt)=>{Vt.exports=globalThis.ReactRedux});var Kt=G(Le=>{"use strict";var Yo=m(),Go=Symbol.for("react.element"),Vo=Symbol.for("react.fragment"),Xo=Object.prototype.hasOwnProperty,Ko=Yo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zo={key:!0,ref:!0,__self:!0,__source:!0};function Xt(e,t,o){var r,n={},i=null,a=null;o!==void 0&&(i=""+o),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)Xo.call(t,r)&&!Zo.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:Go,type:e,key:i,ref:a,props:n,_owner:Ko.current}}Le.Fragment=Vo;Le.jsx=Xt;Le.jsxs=Xt});var p=G((_r,Zt)=>{"use strict";Zt.exports=Kt()});var it=G((qa,xo)=>{xo.exports={v4:globalThis.uuidv4}});var Eo=G((Ei,Mo)=>{Mo.exports=globalThis.ReactDOM});var wo=G(bt=>{"use strict";var Ao=Eo();bt.createRoot=Ao.createRoot,bt.hydrateRoot=Ao.hydrateRoot;var Ai});var ko=s(m());var Ve=s(m());var Et=s(ae()),Wo={activeLayer:"token",position:{x:0,y:0,z:1}},At=(0,Et.createSlice)({name:"app",initialState:Wo,reducers:{openContextMenu(e,{payload:t}){e.contextMenu=t},closeContextMenu(e){e.contextMenu=void 0},openDialog(e,{payload:t}){e.dialog=t},closeDialog(e){e.dialog=void 0},setActiveLayer(e,{payload:t}){e.activeLayer=t},setDragging(e,{payload:t}){e.dragging=t},setPosition(e,{payload:t}){e.position.x=t.x,e.position.y=t.y,e.position.z=t.z}}}),{closeContextMenu:w,closeDialog:T,openContextMenu:se,openDialog:$,setDragging:ie,setActiveLayer:Ye,setPosition:wt}=At.actions,Bt=At.reducer;var we=s(ae()),J=(0,we.createEntityAdapter)(),Ot=(0,we.createSlice)({name:"backdrops",initialState:J.getInitialState(),reducers:{addBackdrop:J.upsertOne,addBackdrops:J.upsertMany,removeBackdrop:J.removeOne,updateBackdrop:J.updateOne}}),{addBackdrop:Rt,addBackdrops:wr,removeBackdrop:It,updateBackdrop:ge}=Ot.actions,Lt=Ot.reducer;var Be=s(ae()),Q=(0,Be.createEntityAdapter)(),Ht=(0,Be.createSlice)({name:"tokens",initialState:Q.getInitialState(),reducers:{addToken:Q.upsertOne,addTokens:Q.upsertMany,removeToken:Q.removeOne,updateToken:Q.updateOne}}),{addToken:zt,addTokens:Ft,removeToken:Nt,updateToken:Se}=Ht.actions,Ut=Ht.reducer;var le=e=>e.app.activeLayer,O=e=>e.app.contextMenu,Oe=e=>e.app.dialog,Re=e=>e.app.dragging,pe=e=>e.app.position,{selectAll:_t,selectEntities:Wt}=Q.getSelectors(e=>e.tokens),{selectAll:Yt,selectEntities:Gt}=J.getSelectors(e=>e.backdrops);var Ie=s(Ge()),f=Ie.useDispatch,d=Ie.useSelector;var He=s(p()),$o={position:"absolute",left:0,top:0,bottom:0,right:0,zIndex:99,background:"black",opacity:.1};function qt({isShown:e,onClick:t}){return e?(0,He.jsx)("div",{style:$o,onClick:t}):null}function $t(){let e=f(),t=d(O),o=(0,Ve.useCallback)(()=>{e(w())},[e]);return(0,He.jsx)(qt,{isShown:!!t,onClick:o})}function Jt(){let e=f(),t=d(Oe),o=(0,Ve.useCallback)(()=>{e(T())},[e]);return(0,He.jsx)(qt,{isShown:!!t,onClick:o})}var k=s(m());var H=s(m());var ve=s(m());function Xe(e=!1){let[t,o]=(0,ve.useState)(e),r=(0,ve.useCallback)(()=>o(!1),[]),n=(0,ve.useCallback)(()=>o(!0),[]);return[t,{clear:r,set:n}]}function Ke(e,t=0){let[o,{clear:r,set:n}]=Xe(!1),[i,a]=(0,H.useState)(NaN),[u,c]=(0,H.useState)(NaN),S=(0,H.useMemo)(()=>o?"grabbing":"grab",[o]),x=(0,H.useCallback)(l=>{l.button===t&&(n(),a(l.clientX),c(l.clientY))},[t,n]),y=(0,H.useCallback)(l=>{if(o){let v=l.clientX-i,Y=l.clientY-u;e(v,Y),a(l.clientX),c(l.clientY)}},[o,e,i,u]),g=(0,H.useCallback)(l=>{o&&(y(l),r())},[o,r,y]);return{cursor:S,onPointerDown:x,onPointerUp:g,onPointerMove:y}}function Qt(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];e&&e.addEventListener&&e.addEventListener.apply(e,t)}function jt(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];e&&e.removeEventListener&&e.removeEventListener.apply(e,t)}var ze=typeof window<"u";var eo=s(m()),Jo=function(e){(0,eo.useEffect)(e,[])},z=Jo;var ue=s(m());var to=s(m());var Qo=function(e){var t=(0,to.useRef)(e);t.current=e,z(function(){return function(){return t.current()}})},oo=Qo;var jo=function(e){var t=(0,ue.useRef)(0),o=(0,ue.useState)(e),r=o[0],n=o[1],i=(0,ue.useCallback)(function(a){cancelAnimationFrame(t.current),t.current=requestAnimationFrame(function(){n(a)})},[]);return oo(function(){cancelAnimationFrame(t.current)}),[r,i]},ro=jo;var R=s(m());function Fe(e,t){t===void 0&&(t=!0);var o=(0,R.useRef)(null),r=(0,R.useRef)(!1),n=(0,R.useRef)(e);n.current=e;var i=(0,R.useCallback)(function(u){r.current&&(n.current(u),o.current=requestAnimationFrame(i))},[]),a=(0,R.useMemo)(function(){return[function(){r.current&&(r.current=!1,o.current&&cancelAnimationFrame(o.current))},function(){r.current||(r.current=!0,o.current=requestAnimationFrame(i))},function(){return r.current}]},[]);return(0,R.useEffect)(function(){return t&&a[1](),a[0]},[]),a}var no=s(m());var er=function(e,t){e===void 0&&(e=1/0),t===void 0&&(t=1/0);var o=ro({width:ze?window.innerWidth:e,height:ze?window.innerHeight:t}),r=o[0],n=o[1];return(0,no.useEffect)(function(){if(ze){var i=function(){n({width:window.innerWidth,height:window.innerHeight})};return Qt(window,"resize",i),function(){jt(window,"resize",i)}}},[]),r},Ze=er;function qe(e,t,o){return e>o?o:e<t?t:e}var Je=s(m());var de="app/drag";function F(e){return 100*e}function fe(e,t,o,r,n,i=Math.round){let a=F(o),u=i((r-e)/a),c=i((n-t)/a);return[u,c]}function $e(e){return JSON.parse(e)}function j(e,t,o){let r=f(),n=(0,Je.useCallback)(a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},[]),i=(0,Je.useCallback)(a=>{a.preventDefault();let{id:u,type:c,ox:S,oy:x}=$e(a.dataTransfer.getData(de)),[y,g]=fe(e+S,t+x,o,a.clientX,a.clientY),l=c==="backdrop"?ge({id:u,changes:{x:y,y:g}}):Se({id:u,changes:{x:y,y:g}});r(l)},[r,e,t,o]);return{onDragOver:n,onDrop:i}}var ao=s(p()),tr=500,or=.2,rr=3;function Qe({onPaint:e}){let t=f(),[o,r]=(0,k.useState)(0),[n,i]=(0,k.useState)(0),[a,u]=(0,k.useState)(1),[c,S]=Fe(()=>{var oe;let A=(oe=x.current)==null?void 0:oe.getContext("2d");A&&x.current&&(e(A,x.current,o,n,a),c())},!0),x=(0,k.useRef)(null),{width:y,height:g}=Ze();(0,k.useEffect)(()=>S(),[y,g,o,n,a,S]);let l=(0,k.useCallback)((A,oe)=>{r(ye=>ye+A),i(ye=>ye+oe)},[]),v=(0,k.useCallback)(A=>{if(A.deltaMode===WheelEvent.DOM_DELTA_PIXEL){let oe=A.deltaY/-tr;u(ye=>qe(ye+oe,or,rr))}},[]),Y=(0,k.useCallback)(A=>{t(se({type:"new",x:A.clientX,y:A.clientY})),A.preventDefault()},[t]),{onDragOver:C,onDrop:D}=j(o,n,a),Ct=Ke(l),{cursor:te}=Ct,Ue=Ae(Ct,["cursor"]),Io=(0,k.useMemo)(()=>({cursor:te,width:y,height:g}),[te,g,y]);return(0,ao.jsx)("canvas",ne(re({},Ue),{"data-testid":"scrollable-canvas",ref:x,width:y,height:g,style:Io,onWheel:v,onDragOver:C,onDrop:D,onContextMenu:Y}))}var so=s(m());var io=s(p());function ee({children:e,type:t}){let o=d(O),r=(0,so.useMemo)(()=>({position:"absolute",zIndex:100,left:o&&`${o.x}px`,top:o&&`${o.y}px`,background:"white",border:"1px solid black",padding:4,display:(o==null?void 0:o.type)===t?"flex":"none",flexDirection:"column"}),[o,t]);return(0,io.jsx)("div",{style:r,children:e})}var et=s(m()),he=s(p());function tt(){let e=f(),t=d(O),o=(0,et.useCallback)(()=>{(t==null?void 0:t.type)==="backdrop"&&e($({type:"backdrop",id:t.id})),e(w())},[e,t]),r=(0,et.useCallback)(()=>{(t==null?void 0:t.type)==="backdrop"&&e(It(t.id)),e(w())},[e,t]);return(0,he.jsxs)(ee,{type:"backdrop",children:[(0,he.jsx)("button",{onClick:o,children:"Edit..."}),(0,he.jsx)("button",{onClick:r,children:"Delete"})]})}var P=s(m());function ke(e){return JSON.stringify(e)}var ot=s(p());function rt({backdrop:e}){let t=f(),o=d(pe),r=d(le),n=(0,P.useMemo)(()=>F(o.z),[o.z]),i=(0,P.useMemo)(()=>e.x*n+o.x,[n,o.x,e.x]),a=(0,P.useMemo)(()=>e.y*n+o.y,[n,o.y,e.y]),u=(0,P.useMemo)(()=>n*e.width,[n,e.width]),c=(0,P.useMemo)(()=>n*e.height,[n,e.height]),S=(0,P.useCallback)(D=>{let te=D.clientX-i,Ue=D.clientY-a;D.dataTransfer.setData(de,ke({id:e.id,type:"backdrop",ox:te,oy:Ue})),D.dataTransfer.effectAllowed="move",t(ie(e.id))},[e.id,t,i,a]),x=(0,P.useCallback)(()=>{t(ie())},[t]),{onDragOver:y,onDrop:g}=j(o.x,o.y,o.z),l=(0,P.useCallback)(D=>{t(se({type:"backdrop",id:e.id,x:D.clientX,y:D.clientY})),D.preventDefault()},[e.id,t]),v=d(Re),Y=(0,P.useMemo)(()=>r!=="backdrop"?"none":!v||v===e.id?"all":"none",[v,r,e.id]),C=(0,P.useMemo)(()=>({position:"absolute",cursor:"pointer",pointerEvents:Y,left:i,top:a,zIndex:10,width:u,height:c}),[c,i,Y,a,u]);return(0,ot.jsx)("div",{draggable:"true",style:C,onDragStart:S,onDragEnd:x,onDragOver:y,onDrop:g,onContextMenu:l,children:(0,ot.jsx)("img",{src:e.url,alt:e.id,width:u,height:c})})}var be=s(p());function nt(){let e=d(Yt);return(0,be.jsx)(be.Fragment,{children:e.map(t=>(0,be.jsx)(rt,{backdrop:t},t.id))})}var M=s(m());var ce=s(m()),V=s(p()),lo={display:"flex",width:300,gap:4},po={fontWeight:"bold",width:40,textAlign:"right"},uo={flexGrow:1};function me({label:e,readOnly:t,value:o,setValue:r}){let n=(0,ce.useId)(),i=(0,ce.useCallback)(a=>r(a.currentTarget.value),[r]);return(0,V.jsxs)("div",{style:lo,children:[(0,V.jsx)("label",{htmlFor:n,style:po,children:e}),(0,V.jsx)("input",{id:n,style:uo,type:"string",value:o,readOnly:t,onChange:i})]})}function N({label:e,value:t,setValue:o,min:r,max:n}){let i=(0,ce.useId)(),a=(0,ce.useCallback)(u=>o(u.currentTarget.valueAsNumber),[o]);return(0,V.jsxs)("div",{style:lo,children:[(0,V.jsx)("label",{htmlFor:i,style:po,children:e}),(0,V.jsx)("input",{id:i,style:uo,type:"number",value:t,onChange:a,min:r,max:n})]})}var fo=s(m());function b(e,t){return(0,fo.useCallback)(o=>e(r=>ne(re({},r),{[t]:o})),[t,e])}var U=s(p());function Ce({backdrop:e,setBackdrop:t,isNew:o=!1}){let r=b(t,"id"),n=b(t,"url"),i=b(t,"x"),a=b(t,"y"),u=b(t,"width"),c=b(t,"height");return(0,U.jsxs)("fieldset",{children:[(0,U.jsx)(me,{label:"ID",value:e.id,setValue:r,readOnly:!o}),(0,U.jsx)(me,{label:"URL",value:e.url,setValue:n}),(0,U.jsx)(N,{label:"X",value:e.x,setValue:i}),(0,U.jsx)(N,{label:"Y",value:e.y,setValue:a}),(0,U.jsx)(N,{label:"Width",value:e.width,setValue:u,min:1}),(0,U.jsx)(N,{label:"Height",value:e.height,setValue:c,min:1})]})}var ar={position:"fixed",zIndex:100,top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",background:"white",border:"1px solid black",padding:4,display:"flex",flexDirection:"column",overflow:"hidden"},X=ar;var I=s(p()),sr={display:"flex"},ir={flexGrow:1},lr={display:"flex"},co={flexGrow:1};function at({id:e}){let t=(0,M.useId)(),o=f(),r=d(Gt),[n,i]=(0,M.useState)({id:"",url:"",x:0,y:0,width:1,height:1}),[a,u]=(0,M.useState)({id:"",url:"",x:0,y:0,width:1,height:1});z(()=>{let l=r[e];l&&(i(l),u(l))});let c=(0,M.useCallback)(l=>{let v=typeof l=="function"?l(a):l;u(v),o(ge({id:e,changes:v}))},[a,o,e]),S=(0,M.useCallback)(()=>{o(T())},[o]),x=(0,M.useCallback)(()=>{o(ge({id:e,changes:n})),o(T())},[o,e,n]),y=(0,M.useMemo)(()=>{if(!a.id||!a.url)return!0},[a.id,a.url]),g=(0,M.useMemo)(()=>{if(a.url)return(0,I.jsx)("img",{src:a.url,alt:a.id,width:64,height:64})},[a.id,a.url]);return(0,I.jsxs)("div",{role:"dialog","aria-labelledby":t,style:X,children:[(0,I.jsxs)("div",{style:sr,children:[(0,I.jsx)("h2",{id:t,style:ir,children:"Edit Backdrop..."}),g]}),(0,I.jsx)(Ce,{backdrop:a,setBackdrop:c}),(0,I.jsxs)("div",{style:lr,children:[(0,I.jsx)("button",{style:co,onClick:x,children:"Cancel"}),(0,I.jsx)("button",{style:co,disabled:y,onClick:S,children:"OK"})]})]})}var E=s(m());var K=s(p());function De({token:e,setToken:t,isNew:o=!1}){let r=b(t,"id"),n=b(t,"url"),i=b(t,"x"),a=b(t,"y"),u=b(t,"size");return(0,K.jsxs)("fieldset",{children:[(0,K.jsx)(me,{label:"ID",value:e.id,setValue:r,readOnly:!o}),(0,K.jsx)(me,{label:"URL",value:e.url,setValue:n}),(0,K.jsx)(N,{label:"X",value:e.x,setValue:i}),(0,K.jsx)(N,{label:"Y",value:e.y,setValue:a}),(0,K.jsx)(N,{label:"Size",value:e.size,setValue:u,min:1,max:5})]})}var L=s(p()),pr={display:"flex"},ur={flexGrow:1},dr={display:"flex"},mo={flexGrow:1};function st({id:e}){let t=(0,E.useId)(),o=f(),r=d(Wt),[n,i]=(0,E.useState)({id:"",url:"",x:0,y:0,size:1}),[a,u]=(0,E.useState)({id:"",url:"",x:0,y:0,size:1});z(()=>{let l=r[e];l&&(i(l),u(l))});let c=(0,E.useCallback)(l=>{let v=typeof l=="function"?l(a):l;u(v),o(Se({id:e,changes:v}))},[a,o,e]),S=(0,E.useCallback)(()=>{o(T())},[o]),x=(0,E.useCallback)(()=>{o(Se({id:e,changes:n})),o(T())},[o,e,n]),y=(0,E.useMemo)(()=>{if(!a.id||!a.url)return!0},[a.id,a.url]),g=(0,E.useMemo)(()=>{if(a.url)return(0,L.jsx)("img",{src:a.url,alt:a.id,width:64,height:64})},[a.id,a.url]);return(0,L.jsxs)("div",{role:"dialog","aria-labelledby":t,style:X,children:[(0,L.jsxs)("div",{style:pr,children:[(0,L.jsx)("h2",{id:t,style:ur,children:"Edit Token..."}),g]}),(0,L.jsx)(De,{token:a,setToken:c}),(0,L.jsxs)("div",{style:dr,children:[(0,L.jsx)("button",{style:mo,onClick:x,children:"Cancel"}),(0,L.jsx)("button",{style:mo,disabled:y,onClick:S,children:"OK"})]})]})}var _=s(m());var yo=s(it()),Z=s(p()),fr={display:"flex"},cr={flexGrow:1};function lt({x:e,y:t}){let o=(0,_.useId)(),r=f(),[n,i]=(0,_.useState)({id:(0,yo.v4)(),url:"",x:e,y:t,width:1,height:1}),a=(0,_.useCallback)(()=>{r(Rt(n)),r(T())},[n,r]),u=(0,_.useMemo)(()=>{if(!n.id||!n.url)return!0},[n.id,n.url]),c=(0,_.useMemo)(()=>{if(n.url)return(0,Z.jsx)("img",{src:n.url,alt:n.id,width:64,height:64})},[n.id,n.url]);return(0,Z.jsxs)("div",{role:"dialog","aria-labelledby":o,style:X,children:[(0,Z.jsxs)("div",{style:fr,children:[(0,Z.jsx)("h2",{id:o,style:cr,children:"New Backdrop..."}),c]}),(0,Z.jsx)(Ce,{isNew:!0,backdrop:n,setBackdrop:i}),(0,Z.jsx)("button",{disabled:u,onClick:a,children:"OK"})]})}var pt=s(m()),Te=s(p());function ut(){let e=f(),t=d(O),o=d(pe),r=(0,pt.useCallback)(()=>{if(e(w()),t){let[i,a]=fe(o.x,o.y,o.z,t.x,t.y,Math.floor);e($({type:"newBackdrop",x:i,y:a}))}},[e,t,o]),n=(0,pt.useCallback)(()=>{if(e(w()),t){let[i,a]=fe(o.x,o.y,o.z,t.x,t.y,Math.floor);e($({type:"newToken",x:i,y:a}))}},[e,t,o]);return(0,Te.jsxs)(ee,{type:"new",children:[(0,Te.jsx)("button",{onClick:r,children:"New Backdrop..."}),(0,Te.jsx)("button",{onClick:n,children:"New Token..."})]})}var W=s(m());var go=s(it()),q=s(p()),mr={display:"flex"},xr={flexGrow:1};function dt({x:e,y:t}){let o=(0,W.useId)(),r=f(),[n,i]=(0,W.useState)({id:(0,go.v4)(),url:"",x:e,y:t,size:1}),a=(0,W.useCallback)(()=>{r(zt(n)),r(T())},[r,n]),u=(0,W.useMemo)(()=>{if(!n.id||!n.url)return!0},[n.id,n.url]),c=(0,W.useMemo)(()=>{if(n.url)return(0,q.jsx)("img",{src:n.url,alt:n.id,width:64,height:64})},[n.id,n.url]);return(0,q.jsxs)("div",{role:"dialog","aria-labelledby":o,style:X,children:[(0,q.jsxs)("div",{style:mr,children:[(0,q.jsx)("h2",{id:o,style:xr,children:"New Token..."}),c]}),(0,q.jsx)(De,{isNew:!0,token:n,setToken:i}),(0,q.jsx)("button",{disabled:u,onClick:a,children:"OK"})]})}var ft=s(m()),Pe=s(p());function ct(){let e=f(),t=d(O),o=(0,ft.useCallback)(()=>{(t==null?void 0:t.type)==="token"&&e($({type:"token",id:t.id})),e(w())},[e,t]),r=(0,ft.useCallback)(()=>{(t==null?void 0:t.type)==="token"&&e(Nt(t.id)),e(w())},[e,t]);return(0,Pe.jsxs)(ee,{type:"token",children:[(0,Pe.jsx)("button",{onClick:o,children:"Edit..."}),(0,Pe.jsx)("button",{onClick:r,children:"Delete"})]})}var B=s(m());var mt=s(p());function xt({token:e}){let t=f(),o=d(pe),r=d(le),n=(0,B.useMemo)(()=>F(o.z),[o.z]),i=(0,B.useMemo)(()=>e.x*n+o.x,[n,o.x,e.x]),a=(0,B.useMemo)(()=>e.y*n+o.y,[n,o.y,e.y]),u=(0,B.useMemo)(()=>n*e.size,[n,e.size]),c=(0,B.useCallback)(C=>{let D=C.clientX-i,te=C.clientY-a;C.dataTransfer.setData(de,ke({id:e.id,type:"token",ox:D,oy:te})),C.dataTransfer.effectAllowed="move",t(ie(e.id))},[t,i,e.id,a]),S=(0,B.useCallback)(()=>{t(ie())},[t]),{onDragOver:x,onDrop:y}=j(o.x,o.y,o.z),g=(0,B.useCallback)(C=>{t(se({type:"token",id:e.id,x:C.clientX,y:C.clientY})),C.preventDefault()},[e.id,t]),l=d(Re),v=(0,B.useMemo)(()=>r!=="token"?"none":!l||l===e.id?"all":"none",[l,r,e.id]),Y=(0,B.useMemo)(()=>({position:"absolute",cursor:"pointer",pointerEvents:v,left:i,top:a,zIndex:20-e.size,width:u,height:u}),[i,v,u,e.size,a]);return(0,mt.jsx)("div",{draggable:"true",style:Y,onDragStart:c,onDragEnd:S,onDragOver:x,onDrop:y,onContextMenu:g,children:(0,mt.jsx)("img",{src:e.url,alt:e.id,width:u,height:u})})}var Me=s(p());function yt(){let e=d(_t);return(0,Me.jsx)(Me.Fragment,{children:e.map(t=>(0,Me.jsx)(xt,{token:t},t.id))})}var gt=s(m());var So=s(m());var vo=s(p());function Ne(r){var n=r,{children:e,selected:t=!1}=n,o=Ae(n,["children","selected"]);let i=(0,So.useMemo)(()=>({backgroundColor:t?"yellow":void 0}),[t]);return(0,vo.jsx)("button",ne(re({role:"menuitemradio","aria-checked":t,style:i},o),{children:e}))}var xe=s(p()),Sr={position:"absolute",left:16,bottom:16,zIndex:90};function St(){let e=f(),t=d(le),o=(0,gt.useCallback)(()=>e(Ye("backdrop")),[e]),r=(0,gt.useCallback)(()=>e(Ye("token")),[e]);return(0,xe.jsx)("div",{role:"menubar",style:Sr,children:(0,xe.jsxs)("div",{role:"group","aria-label":"Active Layer",children:[(0,xe.jsx)(Ne,{onClick:o,selected:t==="backdrop",children:"Backdrop"}),(0,xe.jsx)(Ne,{onClick:r,selected:t==="token",children:"Token"})]})})}var h=s(p());function ho(e,t){let o=e%t;return o<0?o+t:o}var vr={overflow:"hidden",position:"relative"};function vt(){let e=f(),t=d(Oe);z(()=>{e(Ft([{id:"Birnotec",url:"https://lagdotcom.github.io/dndavies-assets/tk/birnotec.png",x:2,y:3,size:1},{id:"Vassetri",url:"https://5e.tools/img/MM/Yuan-ti%20Abomination.png",x:4,y:4,size:2},{id:"Vassetri2",url:"https://5e.tools/img/MPMM/Yuan-ti%20Anathema.png",x:6,y:3,size:3}]))});let o=(0,ko.useCallback)((r,n,i,a,u)=>{let{width:c,height:S}=n;r.clearRect(0,0,c,S);let x=F(u),y=ho(i,x),g=ho(a,x);r.lineWidth=1,r.strokeStyle="silver";for(let l=y;l<c;l+=x)r.beginPath(),r.moveTo(l,0),r.lineTo(l,S),r.stroke();for(let l=g;l<S;l+=x)r.beginPath(),r.moveTo(0,l),r.lineTo(c,l),r.stroke();e(wt({x:i,y:a,z:u}))},[e]);return(0,h.jsxs)("div",{style:vr,children:[(0,h.jsx)(Qe,{onPaint:o}),(0,h.jsx)(nt,{}),(0,h.jsx)(yt,{}),(0,h.jsx)($t,{}),(0,h.jsx)(Jt,{}),(0,h.jsx)(ut,{}),(0,h.jsx)(tt,{}),(0,h.jsx)(ct,{}),(t==null?void 0:t.type)==="newBackdrop"&&(0,h.jsx)(lt,{x:t.x,y:t.y}),(t==null?void 0:t.type)==="newToken"&&(0,h.jsx)(dt,{x:t.x,y:t.y}),(t==null?void 0:t.type)==="backdrop"&&(0,h.jsx)(at,{id:t.id}),(t==null?void 0:t.type)==="token"&&(0,h.jsx)(st,{id:t.id}),(0,h.jsx)(St,{})]})}var Po=s(Ge());var Do=s(ae());var bo=s(ae());var hr=(0,bo.combineReducers)({app:Bt,backdrops:Lt,tokens:Ut}),Co=hr;function To(e){return(0,Do.configureStore)({reducer:Co,preloadedState:e})}var ht=s(p()),kr=To();function kt(){return(0,ht.jsx)(Po.Provider,{store:kr,children:(0,ht.jsx)(vt,{})})}var Bo=s(wo()),Ro=s(p()),Oo=document.getElementById("app");if(!Oo)throw new Error("app container missing");var br=(0,Bo.createRoot)(Oo);br.render((0,Ro.jsx)(kt,{}));})();
